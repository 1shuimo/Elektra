{% extends 'base.html' %}
{% load static %}
{% block content %}

    
    <div id="mapid" class="mx-auto"></div>
    <script>
        var mymap = L.map('mapid').setView([24.556680, 73.705724], 14);
        mymap.locate();
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1Ijoia2hhbm5ha3NoYXQ3IiwiYSI6ImNrZmlsZjRobTE5ZHMycm8zZ3BkeGFyN3gifQ.1QD2g1KpNcFVUqKJ-M5_9g'
        }).addTo(mymap);

        {% for i in data %}
            {% if i.is_solved %}
                var circle = L.circle([{{i.latitude}}, {{i.longitude}}], {
                    color: 'green',
                    fillColor: '#0dfd04',
                    fillOpacity: 0.5,
                    radius: 500
                }).addTo(mymap);
            {% else %}
                var circle = L.circle([{{i.latitude}}, {{i.longitude}}], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 500
                }).addTo(mymap);
            {% endif %}
        {% endfor %}

        function onLocationFound(e) {
            var radius = e.accuracy;

            L.marker(e.latlng).addTo(mymap)
                .bindPopup("You are within " + radius + " meters from this point").openPopup();

            L.circle(e.latlng, radius).addTo(mymap);
            
        }
        
        mymap.on('locationfound', onLocationFound);
        
        var legend = L.control({ position: "topright" });

        legend.onAdd = function(mymap) {
        var div = L.DomUtil.create("div", "legend");
        div.innerHTML += "<h4>Power Status</h4>";
        div.innerHTML += '<span class="dot" style="  height: 15px;width: 15px;background-color: #0dfd04;border-radius: 50%;display: inline-block;"></span> <span>Power OK</span><br>';
        div.innerHTML += '<span class="dot" style="  height: 15px;width: 15px;background-color: #f03;border-radius: 50%;display: inline-block;"></span> <span>Power Cut</span><br>';
        return div;
        };
        legend.addTo(mymap);
    
    </script>

{% endblock %}

